module.exports=[54627,a=>{"use strict";var b=a.i(66556),c=a.i(95820),d=a.i(19887),e=a.i(30898),f=a.i(32479),g=a.i(27111),h=a.i(56097),i=a.i(15443),j=a.i(27296),k=a.i(6721),l=a.i(36462),m=a.i(31395),n=a.i(80591),o=a.i(11271);let p=[{name:"School Gate",lat:12.9716,lng:77.5946,zone:"Zone P1"},{name:"Park North",lat:12.974,lng:77.5955,zone:"Zone W2"},{name:"Sports Field",lat:12.9705,lng:77.5935,zone:"Zone P2"},{name:"Drainage Area",lat:12.9719,lng:77.595,zone:"Zone P1"},{name:"Construction Site",lat:12.9715,lng:77.5965,zone:"Zone C3"},{name:"Residential Corner",lat:12.971,lng:77.592,zone:"Zone W3"},{name:"Industrial Zone",lat:12.9745,lng:77.5945,zone:"Zone S1"},{name:"Local Market",lat:12.9695,lng:77.5955,zone:"Zone P3"},{name:"Park South",lat:12.9735,lng:77.593,zone:"Zone O1"},{name:"Walking Trail",lat:12.9725,lng:77.5938,zone:"Zone C2"}],q=["Soil contamination","Stagnant water","Plastic / microplastics","Damaged turf / turf runoff","Waste dumping","Other"],r=[{label:"Low",color:"#c6f6d5",textColor:"#15803d"},{label:"Medium",color:"#fcd34d",textColor:"#78350f"},{label:"High",color:"#fca5a5",textColor:"#7f1d1d"}];function s(){let[a,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(null),P=(0,c.useRef)(null),Q=(0,c.useRef)(null),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)("");(0,d.useRouter)(),(0,c.useEffect)(()=>{x?w(!1):"geolocation"in navigator?navigator.geolocation.getCurrentPosition(a=>{let{latitude:b,longitude:c}=a.coords;s({lat:b,lng:c,name:"Current Location"}),w(!1)},a=>{console.log("[NewReport] Geolocation error:",a.message),u("Unable to access your location. Please enable location permissions."),w(!1)}):(u("Geolocation is not supported by your browser."),w(!1))},[x]),(0,c.useEffect)(()=>{z.trim()?C((0,o.fuzzySearch)(z,p)):C([])},[z]);let Z=a=>{s({lat:a.lat,lng:a.lng,name:a.name}),A(""),C([]),y(!1)},$=a=>{let b=a.target.files?.[0];if(b){let a=new FileReader;a.onloadend=()=>{let b=a.result;M(b),O(b)},a.readAsDataURL(b)}},_=async b=>{if(b.preventDefault(),!a?.lat||!a?.lng)return void U("Location is required");if(!D)return void U("Please select a pollution category");if(!F)return void U("Please select a severity level");if(!H.trim())return void U("Please describe the issue");try{S(!0),U(""),console.log("[NewReport] Submitting evidence directly without sessionStorage:",{lat:a.lat,lng:a.lng,category:D,severity:F,description:H,reporter:J||"Anonymous",hasPhoto:!!L});let b={lat:a.lat,lng:a.lng,category:D,severity:F,note:H,reporter:J||"Anonymous",date:new Date().toISOString().split("T")[0],zone:"User Submitted",upvotes:0,verified:!1,status:"Open",images:L?[L]:[]},c=await fetch("/api/evidence/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(console.log("[NewReport] API response:",{status:c.status,ok:c.ok}),!c.ok){let a=await c.json().catch(()=>({error:"Unknown error"}));throw Error(a.error||`Failed to submit report (${c.status})`)}let d=await c.json();console.log("[NewReport] Submission successful:",d),Y(d.id||`E${Date.now()}`),W(!0)}catch(a){console.error("[NewReport] Error submitting report:",a),U(a instanceof Error?a.message:"Failed to submit report. Please try again.")}finally{S(!1)}};return V?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center px-4",style:{backgroundColor:"var(--peep-neutral-1)"},children:[(0,b.jsx)(j.CheckCircle2,{className:"w-16 h-16 mb-4",style:{color:"var(--peep-primary)"}}),(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2 text-center text-balance",children:"Report Submitted!"}),(0,b.jsx)("p",{className:"text-gray-600 text-center mb-2",children:"Your evidence has been added to PEEP."}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 text-center mb-6",children:["ID: ",X]}),(0,b.jsx)(n.default,{href:"/peep/user",className:"w-full max-w-sm py-3 px-4 rounded-2xl font-semibold text-white text-center transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Back to Home"}),(0,b.jsxs)("button",{className:"w-full max-w-sm mt-2 py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-700 text-sm flex items-center justify-center gap-2",children:[(0,b.jsx)(k.Share2,{className:"w-4 h-4"})," Share This Report"]})]}):v&&!x?(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto animate-pulse",style:{backgroundColor:"var(--peep-primary)"},children:(0,b.jsx)(f.MapPin,{className:"w-8 h-8 text-white"})}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Finding your location..."}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"This helps us pinpoint where the issue is."}),(0,b.jsx)("button",{onClick:()=>y(!0),className:"text-sm font-semibold",style:{color:"var(--peep-primary)"},children:"Search location instead"})]})})]}):t&&!x?(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,b.jsxs)("div",{className:"w-full max-w-sm text-center space-y-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto bg-red-100",children:(0,b.jsx)(g.AlertCircle,{className:"w-8 h-8 text-red-600"})}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Location Access Required"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:t}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Please enable location in your browser settings and refresh."}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>window.location.reload(),className:"flex-1 py-3 px-4 rounded-lg font-semibold text-white transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Try Again"}),(0,b.jsx)("button",{onClick:()=>y(!0),className:"flex-1 py-3 px-4 rounded-lg font-semibold border-2",style:{borderColor:"var(--peep-primary)",color:"var(--peep-primary)"},children:"Search Instead"})]})]})})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white z-10",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsxs)("form",{onSubmit:_,className:"flex-1 overflow-y-auto px-4 py-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Location *"}),a?(0,b.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-green-900",children:a.name||`${a.lat.toFixed(4)}, ${a.lng.toFixed(4)}`}),(0,b.jsx)("button",{type:"button",onClick:()=>{s(null),y(!0)},className:"text-xs text-green-700 hover:text-green-900 font-semibold",children:"Change Location"})]}):x?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-2 border-gray-300 rounded-lg",children:[(0,b.jsx)(h.Search,{className:"w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Type location name...",value:z,onChange:a=>A(a.target.value),autoFocus:!0,className:"flex-1 outline-none text-sm"}),z&&(0,b.jsx)("button",{type:"button",onClick:()=>{A(""),C([])},className:"p-1 hover:bg-gray-100 rounded",children:(0,b.jsx)(i.X,{className:"w-4 h-4 text-gray-400"})})]}),B.length>0&&(0,b.jsx)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto",children:B.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>Z(a),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-0 transition-colors",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:a.zone})]},`${a.lat}-${a.lng}`))})]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-700",children:"Suggested locations:"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:p.slice(0,6).map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>Z(a),className:"p-2 text-left rounded border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.zone})]},`${a.lat}-${a.lng}`))})]})]}):null]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Pollution Type *"}),(0,b.jsxs)("select",{value:D,onChange:a=>E(a.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,b.jsx)("option",{value:"",children:"Select category..."}),q.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Severity *"}),(0,b.jsx)("div",{className:"space-y-2",children:r.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>G(a.label),className:`w-full p-3 rounded-lg border-2 transition-all text-left font-semibold ${F===a.label?"border-gray-400 shadow-md":"border-gray-200 hover:border-gray-300"}`,style:{backgroundColor:a.color,color:a.textColor},children:a.label},a.label))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Description *"}),(0,b.jsx)("textarea",{value:H,onChange:a=>I(a.target.value.slice(0,200)),placeholder:"Describe what you see. What's the issue? What's the impact?",className:"w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",rows:4}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-right",children:[H.length,"/200 characters"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Photo (optional)"}),N?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("img",{src:N,alt:"Preview",className:"w-full rounded-lg object-cover max-h-48"}),(0,b.jsx)("button",{type:"button",onClick:()=>{M(null),O(null),P.current&&(P.current.value=""),Q.current&&(Q.current.value="")},className:"w-full py-2 px-4 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 text-sm font-semibold",children:"Remove Photo"})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>Q.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all flex items-center justify-center gap-2 text-sm font-semibold text-gray-700",children:[(0,b.jsx)(l.Camera,{className:"w-5 h-5"})," Take Photo"]}),(0,b.jsx)("button",{type:"button",onClick:()=>P.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all text-sm font-semibold text-gray-700",children:"Choose from Gallery"})]}),(0,b.jsx)("input",{ref:Q,type:"file",accept:"image/*",capture:!0,onChange:$,className:"hidden"}),(0,b.jsx)("input",{ref:P,type:"file",accept:"image/*",onChange:$,className:"hidden"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Your Name (optional)"}),(0,b.jsx)("input",{type:"text",value:J,onChange:a=>K(a.target.value),placeholder:"Leave blank to be anonymous",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),T&&(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex gap-3",children:[(0,b.jsx)(m.AlertTriangle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,b.jsx)("p",{className:"text-sm text-red-700",children:T})]}),(0,b.jsx)("button",{type:"submit",disabled:R||!a||!D||!F||!H.trim(),className:"w-full py-4 px-4 rounded-2xl font-semibold text-white transition-all active:scale-95 disabled:opacity-50 sticky bottom-0 mt-6",style:{backgroundColor:"var(--peep-primary)"},children:R?"Submitting...":"Submit Report"})]})]})}a.s(["default",()=>s])}];

//# sourceMappingURL=Downloads_code_app_peep_user_new-report_page_tsx_f47332fb._.js.map