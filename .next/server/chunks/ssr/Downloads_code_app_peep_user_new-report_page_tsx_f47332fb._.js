module.exports=[54627,a=>{"use strict";var b=a.i(66556),c=a.i(95820),d=a.i(19887),e=a.i(30898),f=a.i(32479),g=a.i(27111),h=a.i(56097),i=a.i(15443),j=a.i(27296),k=a.i(6721),l=a.i(36462),m=a.i(31395),n=a.i(80591),o=a.i(11271);let p=[{name:"School Gate",lat:12.9716,lng:77.5946,zone:"Zone P1"},{name:"Park North",lat:12.974,lng:77.5955,zone:"Zone W2"},{name:"Sports Field",lat:12.9705,lng:77.5935,zone:"Zone P2"},{name:"Drainage Area",lat:12.9719,lng:77.595,zone:"Zone P1"},{name:"Construction Site",lat:12.9715,lng:77.5965,zone:"Zone C3"},{name:"Residential Corner",lat:12.971,lng:77.592,zone:"Zone W3"},{name:"Industrial Zone",lat:12.9745,lng:77.5945,zone:"Zone S1"},{name:"Local Market",lat:12.9695,lng:77.5955,zone:"Zone P3"},{name:"Park South",lat:12.9735,lng:77.593,zone:"Zone O1"},{name:"Walking Trail",lat:12.9725,lng:77.5938,zone:"Zone C2"}],q=["Soil contamination","Stagnant water","Plastic / microplastics","Damaged turf / turf runoff","Waste dumping","Other"],r=[{label:"Low",color:"#c6f6d5",textColor:"#15803d"},{label:"Medium",color:"#fcd34d",textColor:"#78350f"},{label:"High",color:"#fca5a5",textColor:"#7f1d1d"}];function s(){let[a,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(null),Z=(0,c.useRef)(null),$=(0,c.useRef)(null),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)("");(0,d.useRouter)(),(0,c.useEffect)(()=>{x?w(!1):"geolocation"in navigator?navigator.geolocation.getCurrentPosition(a=>{let{latitude:b,longitude:c}=a.coords;s({lat:b,lng:c,name:"Current Location"}),w(!1)},a=>{console.log("[NewReport] Geolocation error:",a.message),u("Unable to access your location. Please enable location permissions."),w(!1)}):(u("Geolocation is not supported by your browser."),w(!1))},[x]),(0,c.useEffect)(()=>{B.trim()?E((0,o.fuzzySearch)(B,p)):E([])},[B]);let ah=a=>{s({lat:a.lat,lng:a.lng,name:a.name}),C(""),E([]),y(!1)},ai=a=>{let b=a.target.files?.[0];if(b){let a=new FileReader;a.onloadend=()=>{let b=a.result;W(b),Y(b)},a.readAsDataURL(b)}},aj=async b=>{if(b.preventDefault(),!a?.lat||!a?.lng)return void ac("Location is required");if(!N)return void ac("Please select a pollution category");if(!P)return void ac("Please select a severity level");if(!R.trim())return void ac("Please describe the issue");try{aa(!0),ac(""),console.log("[NewReport] Submitting evidence directly without sessionStorage:",{lat:a.lat,lng:a.lng,category:N,severity:P,description:R,reporter:T||"Anonymous",hasPhoto:!!V});let b={lat:a.lat,lng:a.lng,category:N,severity:P,note:R,reporter:T||"Anonymous",date:new Date().toISOString().split("T")[0],zone:"User Submitted",upvotes:0,verified:!1,status:"Open",images:V?[V]:[]},c=await fetch("/api/evidence/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(console.log("[NewReport] API response:",{status:c.status,ok:c.ok}),!c.ok){let a=await c.json().catch(()=>({error:"Unknown error"}));throw Error(a.error||`Failed to submit report (${c.status})`)}let d=await c.json();console.log("[NewReport] Submission successful:",d),ag(d.id||`E${Date.now()}`),ae(!0)}catch(a){console.error("[NewReport] Error submitting report:",a),ac(a instanceof Error?a.message:"Failed to submit report. Please try again.")}finally{aa(!1)}};return ad?(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center px-4",style:{backgroundColor:"var(--peep-neutral-1)"},children:[(0,b.jsx)(j.CheckCircle2,{className:"w-16 h-16 mb-4",style:{color:"var(--peep-primary)"}}),(0,b.jsx)("h1",{className:"text-2xl font-bold mb-2 text-center text-balance",children:"Report Submitted!"}),(0,b.jsx)("p",{className:"text-gray-600 text-center mb-2",children:"Your evidence has been added to PEEP."}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 text-center mb-6",children:["ID: ",af]}),(0,b.jsx)(n.default,{href:"/peep/user",className:"w-full max-w-sm py-3 px-4 rounded-2xl font-semibold text-white text-center transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Back to Home"}),(0,b.jsxs)("button",{className:"w-full max-w-sm mt-2 py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-700 text-sm flex items-center justify-center gap-2",children:[(0,b.jsx)(k.Share2,{className:"w-4 h-4"})," Share This Report"]})]}):v&&!x?(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto animate-pulse",style:{backgroundColor:"var(--peep-primary)"},children:(0,b.jsx)(f.MapPin,{className:"w-8 h-8 text-white"})}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Finding your location..."}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"This helps us pinpoint where the issue is."}),(0,b.jsx)("button",{onClick:()=>y(!0),className:"text-sm font-semibold",style:{color:"var(--peep-primary)"},children:"Search location instead"})]})})]}):t&&!x?(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,b.jsxs)("div",{className:"w-full max-w-sm text-center space-y-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto bg-red-100",children:(0,b.jsx)(g.AlertCircle,{className:"w-8 h-8 text-red-600"})}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Location Access Required"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:t}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Please enable location in your browser settings and refresh."}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:()=>window.location.reload(),className:"flex-1 py-3 px-4 rounded-lg font-semibold text-white transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Try Again"}),(0,b.jsx)("button",{onClick:()=>y(!0),className:"flex-1 py-3 px-4 rounded-lg font-semibold border-2",style:{borderColor:"var(--peep-primary)",color:"var(--peep-primary)"},children:"Search Instead"})]})]})})]}):(0,b.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white z-10",children:[(0,b.jsx)(n.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,b.jsx)(e.ChevronLeft,{className:"w-5 h-5"})}),(0,b.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,b.jsx)("div",{className:"w-10"})]}),(0,b.jsxs)("form",{onSubmit:aj,className:"flex-1 overflow-y-auto px-4 py-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Location *"}),a?(0,b.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 space-y-2",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-green-900",children:a.name||`${a.lat.toFixed(4)}, ${a.lng.toFixed(4)}`}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{s(null),y(!0)},className:"text-xs text-green-700 hover:text-green-900 font-semibold",children:"Change Location"}),(0,b.jsx)("button",{type:"button",onClick:()=>{s(null),A(!0)},className:"text-xs text-green-700 hover:text-green-900 font-semibold",children:"Use Custom Address"})]})]}):z?(0,b.jsxs)("div",{className:"space-y-3 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold text-sm text-blue-900",children:"Custom Location"}),(0,b.jsx)("button",{type:"button",onClick:()=>{A(!1),G(""),I(""),K(""),M("")},className:"text-xs text-blue-700 hover:text-blue-900 font-semibold",children:"Back"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-semibold text-blue-900 mb-2",children:"Google Maps Link"}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)("input",{type:"text",placeholder:"Paste Google Maps link (e.g., https://maps.google.com/...)",className:"flex-1 px-3 py-2 border border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400",onPaste:a=>{let b=a.clipboardData.getData("text");(b.includes("google.com/maps")||b.includes("maps.google"))&&(a=>{M("");try{let b=new URL(a.trim()),c=null,d=null,e=b.pathname.match(/place\/([\d.-]+),([\d.-]+)/);if(e&&(c=parseFloat(e[1]),d=parseFloat(e[2])),!c||!d){let a=b.searchParams.get("q");if(a){let b=a.match(/([\d.-]+),([\d.-]+)/);b&&(c=parseFloat(b[1]),d=parseFloat(b[2]))}}if(c&&d&&!isNaN(c)&&!isNaN(d)){s({lat:c,lng:d,name:`Custom Location (${c.toFixed(4)}, ${d.toFixed(4)})`}),G(""),I(""),K(""),A(!1);return}M("Could not extract coordinates from the Google Maps link. Try copying the full link from the address bar.")}catch(a){M("Invalid URL. Please paste a valid Google Maps link.")}})(b)}})}),(0,b.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"ðŸ’¡ Copy the full link from Google Maps address bar and paste it here"})]}),(0,b.jsxs)("div",{className:"border-t border-blue-200 pt-3",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-blue-900 mb-2",children:"Or enter coordinates manually"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-blue-900 mb-1",children:"Address (optional)"}),(0,b.jsx)("input",{type:"text",placeholder:"e.g., School Gate, Downtown",value:F,onChange:a=>G(a.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-2"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-blue-900 mb-1",children:"Latitude"}),(0,b.jsx)("input",{type:"number",step:"0.0001",placeholder:"12.9716",value:H,onChange:a=>I(a.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-blue-900 mb-1",children:"Longitude"}),(0,b.jsx)("input",{type:"number",step:"0.0001",placeholder:"77.5946",value:J,onChange:a=>K(a.target.value),className:"w-full px-3 py-2 border border-blue-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400"})]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>{M("");let a=parseFloat(H),b=parseFloat(J);isNaN(a)||isNaN(b)?M("Please enter valid latitude and longitude numbers"):a<-90||a>90?M("Latitude must be between -90 and 90"):b<-180||b>180?M("Longitude must be between -180 and 180"):(s({lat:a,lng:b,name:F||`Custom Location (${a.toFixed(4)}, ${b.toFixed(4)})`}),A(!1))},className:"w-full mt-3 py-2 px-4 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition",children:"Confirm Location"})]}),L&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2 mt-2",children:(0,b.jsx)("p",{className:"text-xs text-red-700",children:L})})]}):x?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-2 border-gray-300 rounded-lg",children:[(0,b.jsx)(h.Search,{className:"w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Type location name...",value:B,onChange:a=>C(a.target.value),autoFocus:!0,className:"flex-1 outline-none text-sm"}),B&&(0,b.jsx)("button",{type:"button",onClick:()=>{C(""),E([])},className:"p-1 hover:bg-gray-100 rounded",children:(0,b.jsx)(i.X,{className:"w-4 h-4 text-gray-400"})})]}),D.length>0&&(0,b.jsx)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto",children:D.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>ah(a),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-0 transition-colors",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:a.zone})]},`${a.lat}-${a.lng}`))})]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-700",children:"Suggested locations:"}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:p.slice(0,6).map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>ah(a),className:"p-2 text-left rounded border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.zone})]},`${a.lat}-${a.lng}`))})]}),(0,b.jsx)("button",{type:"button",onClick:()=>A(!0),className:"w-full mt-2 py-2 px-4 border-2 border-dashed border-gray-300 rounded-lg text-sm font-semibold text-gray-600 hover:border-gray-400 hover:bg-gray-50 transition",children:"+ Use Custom Address or Google Maps Link"})]}):null]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Pollution Type *"}),(0,b.jsxs)("select",{value:N,onChange:a=>O(a.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,b.jsx)("option",{value:"",children:"Select category..."}),q.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Severity *"}),(0,b.jsx)("div",{className:"space-y-2",children:r.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>Q(a.label),className:`w-full p-3 rounded-lg border-2 transition-all text-left font-semibold ${P===a.label?"border-gray-400 shadow-md":"border-gray-200 hover:border-gray-300"}`,style:{backgroundColor:a.color,color:a.textColor},children:a.label},a.label))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Description *"}),(0,b.jsx)("textarea",{value:R,onChange:a=>S(a.target.value.slice(0,200)),placeholder:"Describe what you see. What's the issue? What's the impact?",className:"w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",rows:4}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-right",children:[R.length,"/200 characters"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Photo (optional)"}),X?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("img",{src:X,alt:"Preview",className:"w-full rounded-lg object-cover max-h-48"}),(0,b.jsx)("button",{type:"button",onClick:()=>{W(null),Y(null),Z.current&&(Z.current.value=""),$.current&&($.current.value="")},className:"w-full py-2 px-4 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 text-sm font-semibold",children:"Remove Photo"})]}):(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>$.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all flex items-center justify-center gap-2 text-sm font-semibold text-gray-700",children:[(0,b.jsx)(l.Camera,{className:"w-5 h-5"})," Take Photo"]}),(0,b.jsx)("button",{type:"button",onClick:()=>Z.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all text-sm font-semibold text-gray-700",children:"Choose from Gallery"})]}),(0,b.jsx)("input",{ref:$,type:"file",accept:"image/*",capture:!0,onChange:ai,className:"hidden"}),(0,b.jsx)("input",{ref:Z,type:"file",accept:"image/*",onChange:ai,className:"hidden"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Your Name (optional)"}),(0,b.jsx)("input",{type:"text",value:T,onChange:a=>U(a.target.value),placeholder:"Leave blank to be anonymous",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),ab&&(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex gap-3",children:[(0,b.jsx)(m.AlertTriangle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,b.jsx)("p",{className:"text-sm text-red-700",children:ab})]}),(0,b.jsx)("button",{type:"submit",disabled:_||!a||!N||!P||!R.trim(),className:"w-full py-4 px-4 rounded-2xl font-semibold text-white transition-all active:scale-95 disabled:opacity-50 sticky bottom-0 mt-6",style:{backgroundColor:"var(--peep-primary)"},children:_?"Submitting...":"Submit Report"})]})]})}a.s(["default",()=>s])}];

//# sourceMappingURL=Downloads_code_app_peep_user_new-report_page_tsx_f47332fb._.js.map