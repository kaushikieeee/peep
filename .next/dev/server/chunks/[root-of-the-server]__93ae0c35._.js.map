{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/lib/googleSheetsServerClient.ts"],"sourcesContent":["/**\n * Server-side Google Sheets API Client\n * Uses Service Account for secure server-side operations\n * \n * Setup:\n * 1. Create a Google Service Account:\n *    - Go to Google Cloud Console\n *    - Create a new project (or use existing)\n *    - Enable Google Sheets API\n *    - Create Service Account with Editor role\n *    - Create and download JSON key\n * \n * 2. Share your Google Sheet with the service account email:\n *    - Copy the \"client_email\" from the JSON key\n *    - Share the sheet with that email, give it Editor access\n * \n * 3. Set environment variables in .env.local:\n *    GOOGLE_SHEETS_PRIVATE_KEY=your_private_key_here\n *    GOOGLE_SHEETS_CLIENT_EMAIL=your_client_email_here\n *    GOOGLE_SHEETS_ID=your_sheet_id_here (same as NEXT_PUBLIC version)\n */\n\nimport { google } from 'googleapis';\n\nlet sheetsClient: any = null;\n\nfunction getAuthClient() {\n  if (!sheetsClient) {\n    const privateKey = process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, '\\n');\n    const clientEmail = process.env.GOOGLE_SHEETS_CLIENT_EMAIL;\n\n    if (!privateKey || !clientEmail) {\n      throw new Error('Google Sheets credentials not configured. Please set GOOGLE_SHEETS_PRIVATE_KEY and GOOGLE_SHEETS_CLIENT_EMAIL in .env.local');\n    }\n\n    const auth = new google.auth.JWT({\n      email: clientEmail,\n      key: privateKey,\n      scopes: ['https://www.googleapis.com/auth/spreadsheets'],\n    });\n\n    sheetsClient = google.sheets({ version: 'v4', auth });\n  }\n\n  return sheetsClient;\n}\n\nexport interface UpdateRowParams {\n  sheetName: string;\n  rowIndex: number;\n  values: any[];\n}\n\nexport interface AppendRowParams {\n  sheetName: string;\n  values: any[];\n}\n\n/**\n * Update a row in the Google Sheet\n * @param sheetName - Name of the sheet tab (e.g., 'providers', 'problems')\n * @param rowIndex - 1-based row index (1 = header, 2 = first data row)\n * @param values - Array of values to update\n */\nexport async function updateSheetRow({\n  sheetName,\n  rowIndex,\n  values,\n}: UpdateRowParams) {\n  try {\n    const sheets = getAuthClient();\n    const sheetId = process.env.GOOGLE_SHEETS_ID;\n\n    if (!sheetId) {\n      throw new Error('GOOGLE_SHEETS_ID not configured');\n    }\n\n    // Get sheet metadata to find proper range\n    const metadata = await sheets.spreadsheets.get({ spreadsheetId: sheetId });\n    const sheet = metadata.data.sheets?.find((s: any) => s.properties?.title === sheetName);\n\n    if (!sheet) {\n      throw new Error(`Sheet \"${sheetName}\" not found`);\n    }\n\n    const range = `${sheetName}!A${rowIndex}:Z${rowIndex}`;\n\n    const result = await sheets.spreadsheets.values.update({\n      spreadsheetId: sheetId,\n      range,\n      valueInputOption: 'RAW',\n      requestBody: {\n        values: [values],\n      },\n    });\n\n    return result.data;\n  } catch (error) {\n    console.error('Error updating sheet row:', error);\n    throw error;\n  }\n}\n\n/**\n * Append a new row to the Google Sheet\n * @param sheetName - Name of the sheet tab\n * @param values - Array of values for the new row\n */\nexport async function appendSheetRow({\n  sheetName,\n  values,\n}: AppendRowParams) {\n  try {\n    const sheets = getAuthClient();\n    const sheetId = process.env.GOOGLE_SHEETS_ID;\n\n    if (!sheetId) {\n      throw new Error('GOOGLE_SHEETS_ID not configured');\n    }\n\n    const range = `${sheetName}!A:Z`;\n\n    const result = await sheets.spreadsheets.values.append({\n      spreadsheetId: sheetId,\n      range,\n      valueInputOption: 'RAW',\n      requestBody: {\n        values: [values],\n      },\n    });\n\n    return result.data;\n  } catch (error) {\n    console.error('Error appending sheet row:', error);\n    throw error;\n  }\n}\n\n/**\n * Delete a row from the Google Sheet (by clearing it)\n * @param sheetName - Name of the sheet tab\n * @param rowIndex - 1-based row index\n */\nexport async function deleteSheetRow(\n  sheetName: string,\n  rowIndex: number\n) {\n  try {\n    const sheets = getAuthClient();\n    const spreadsheetId = process.env.GOOGLE_SHEETS_ID;\n\n    if (!spreadsheetId) {\n      throw new Error('GOOGLE_SHEETS_ID not configured');\n    }\n\n    // First, get the sheet metadata to find the sheetId for the given sheetName\n    const metadata = await sheets.spreadsheets.get({ spreadsheetId });\n    const sheet = metadata.data.sheets?.find((s: any) => s.properties?.title === sheetName);\n\n    if (!sheet) {\n      throw new Error(`Sheet \"${sheetName}\" not found`);\n    }\n\n    const sheetId = sheet.properties?.sheetId;\n\n    // Delete the row using batchUpdate with DeleteDimensionRequest\n    const result = await sheets.spreadsheets.batchUpdate({\n      spreadsheetId,\n      requestBody: {\n        requests: [\n          {\n            deleteDimension: {\n              range: {\n                sheetId,\n                dimension: 'ROWS',\n                startIndex: rowIndex - 1, // 0-based index\n                endIndex: rowIndex, // exclusive\n              },\n            },\n          },\n        ],\n      },\n    });\n\n    return result.data;\n  } catch (error) {\n    console.error('Error deleting sheet row:', error);\n    throw error;\n  }\n}\n\n/**\n * Get all rows from a sheet\n * @param sheetName - Name of the sheet tab\n */\nexport async function getSheetRows(sheetName: string) {\n  try {\n    const sheets = getAuthClient();\n    const sheetId = process.env.GOOGLE_SHEETS_ID;\n\n    if (!sheetId) {\n      throw new Error('GOOGLE_SHEETS_ID not configured');\n    }\n\n    const result = await sheets.spreadsheets.values.get({\n      spreadsheetId: sheetId,\n      range: `${sheetName}!A:Z`,\n    });\n\n    return result.data.values || [];\n  } catch (error) {\n    console.error('Error getting sheet rows:', error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/app/api/admin/sheets/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { updateSheetRow, appendSheetRow, deleteSheetRow } from '@/lib/googleSheetsServerClient';\n\n// Verify admin authentication\nfunction verifyAdminAuth(request: NextRequest): boolean {\n  const authHeader = request.headers.get('authorization');\n  const token = authHeader?.replace('Bearer ', '');\n  \n  // For now, we'll use a simple token verification\n  // In production, you should use proper session management (JWT, etc.)\n  return token === process.env.ADMIN_API_TOKEN || \n         request.cookies.get('admin-auth')?.value === 'true';\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Verify admin is authenticated\n    if (!verifyAdminAuth(request)) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      );\n    }\n\n    const { action, sheetName, rowIndex, values, data } = await request.json();\n\n    if (!sheetName) {\n      return NextResponse.json(\n        { error: 'sheetName is required' },\n        { status: 400 }\n      );\n    }\n\n    switch (action) {\n      case 'update':\n        if (!rowIndex || !values) {\n          return NextResponse.json(\n            { error: 'rowIndex and values are required for update' },\n            { status: 400 }\n          );\n        }\n        const updateResult = await updateSheetRow({\n          sheetName,\n          rowIndex,\n          values,\n        });\n        return NextResponse.json({ success: true, data: updateResult });\n\n      case 'append':\n        if (!values) {\n          return NextResponse.json(\n            { error: 'values are required for append' },\n            { status: 400 }\n          );\n        }\n        const appendResult = await appendSheetRow({\n          sheetName,\n          values,\n        });\n        return NextResponse.json({ success: true, data: appendResult });\n\n      case 'delete':\n        if (!rowIndex) {\n          return NextResponse.json(\n            { error: 'rowIndex is required for delete' },\n            { status: 400 }\n          );\n        }\n        const deleteResult = await deleteSheetRow(sheetName, rowIndex);\n        return NextResponse.json({ success: true, data: deleteResult });\n\n      default:\n        return NextResponse.json(\n          { error: 'Invalid action' },\n          { status: 400 }\n        );\n    }\n  } catch (error) {\n    console.error('API Error:', error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,8BAA8B;AAC9B,SAAS,gBAAgB,OAAoB;IAC3C,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,QAAQ,YAAY,QAAQ,WAAW;IAE7C,iDAAiD;IACjD,sEAAsE;IACtE,OAAO,UAAU,QAAQ,GAAG,CAAC,eAAe,IACrC,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe,UAAU;AACtD;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,gCAAgC;QAChC,IAAI,CAAC,gBAAgB,UAAU;YAC7B,OAAO,oSAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExE,IAAI,CAAC,WAAW;YACd,OAAO,oSAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAQ;YACN,KAAK;gBACH,IAAI,CAAC,YAAY,CAAC,QAAQ;oBACxB,OAAO,oSAAY,CAAC,IAAI,CACtB;wBAAE,OAAO;oBAA8C,GACvD;wBAAE,QAAQ;oBAAI;gBAElB;gBACA,MAAM,eAAe,MAAM,IAAA,wKAAc,EAAC;oBACxC;oBACA;oBACA;gBACF;gBACA,OAAO,oSAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAM,MAAM;gBAAa;YAE/D,KAAK;gBACH,IAAI,CAAC,QAAQ;oBACX,OAAO,oSAAY,CAAC,IAAI,CACtB;wBAAE,OAAO;oBAAiC,GAC1C;wBAAE,QAAQ;oBAAI;gBAElB;gBACA,MAAM,eAAe,MAAM,IAAA,wKAAc,EAAC;oBACxC;oBACA;gBACF;gBACA,OAAO,oSAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAM,MAAM;gBAAa;YAE/D,KAAK;gBACH,IAAI,CAAC,UAAU;oBACb,OAAO,oSAAY,CAAC,IAAI,CACtB;wBAAE,OAAO;oBAAkC,GAC3C;wBAAE,QAAQ;oBAAI;gBAElB;gBACA,MAAM,eAAe,MAAM,IAAA,wKAAc,EAAC,WAAW;gBACrD,OAAO,oSAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAM,MAAM;gBAAa;YAE/D;gBACE,OAAO,oSAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAiB,GAC1B;oBAAE,QAAQ;gBAAI;QAEpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,oSAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAwB,GAC1E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}