{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/app/api/admin/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport crypto from 'crypto';\n\n// In-memory rate limiting store (for production, use Redis)\nconst loginAttempts = new Map<string, { count: number; resetTime: number }>();\n\nconst MAX_ATTEMPTS = 5;\nconst LOCKOUT_DURATION = 15 * 60 * 1000; // 15 minutes\nconst SESSION_DURATION = 24 * 60 * 60 * 1000; // 24 hours\n\n/**\n * Helper to hash passwords (simple PBKDF2)\n */\nfunction hashPassword(password: string, salt: string): string {\n  return crypto\n    .pbkdf2Sync(password, salt, 1000, 64, 'sha256')\n    .toString('hex');\n}\n\n/**\n * Check if IP/email is rate limited\n */\nfunction isRateLimited(key: string): boolean {\n  const attempt = loginAttempts.get(key);\n  if (!attempt) return false;\n\n  const now = Date.now();\n  if (now > attempt.resetTime) {\n    loginAttempts.delete(key);\n    return false;\n  }\n\n  return attempt.count >= MAX_ATTEMPTS;\n}\n\n/**\n * Record failed login attempt\n */\nfunction recordFailedAttempt(key: string): void {\n  const now = Date.now();\n  const attempt = loginAttempts.get(key);\n\n  if (!attempt || now > attempt.resetTime) {\n    loginAttempts.set(key, {\n      count: 1,\n      resetTime: now + LOCKOUT_DURATION,\n    });\n  } else {\n    attempt.count++;\n  }\n}\n\n/**\n * Clear failed attempts\n */\nfunction clearAttempts(key: string): void {\n  loginAttempts.delete(key);\n}\n\n/**\n * Generate secure session token\n */\nfunction generateToken(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Parse request body with error handling\n    let body;\n    try {\n      body = await request.json();\n    } catch (parseError) {\n      console.error('Failed to parse request body:', parseError);\n      return NextResponse.json(\n        { message: 'Invalid request format' },\n        { status: 400 }\n      );\n    }\n\n    const { email, password } = body;\n\n    // Input validation\n    if (!email || !password) {\n      return NextResponse.json(\n        { message: 'Email and password are required' },\n        { status: 400 }\n      );\n    }\n\n    // Email validation\n    if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) {\n      return NextResponse.json(\n        { message: 'Invalid email format' },\n        { status: 400 }\n      );\n    }\n\n    // Get client IP for rate limiting (X-Forwarded-For or connection IP)\n    const clientIP =\n      request.headers.get('x-forwarded-for')?.split(',')[0].trim() ||\n      request.headers.get('x-real-ip') ||\n      'unknown';\n\n    const rateLimitKey = `${clientIP}:${email}`;\n\n    // Check if account is locked\n    if (isRateLimited(rateLimitKey)) {\n      return NextResponse.json(\n        { message: 'Too many failed login attempts. Please try again later.' },\n        { status: 429 }\n      );\n    }\n\n    // Get credentials from environment variables\n    const adminEmail = process.env.NEXT_PUBLIC_ADMIN_EMAIL || 'admin@peep.com';\n    const adminPassword = process.env.NEXT_PUBLIC_ADMIN_PASSWORD || 'admin123';\n\n    // Simple string comparison (in production, use proper password hashing)\n    const emailMatch = email === adminEmail;\n    const passwordMatch = password === adminPassword;\n\n    if (!emailMatch || !passwordMatch) {\n      recordFailedAttempt(rateLimitKey);\n      \n      // Don't reveal which field is wrong\n      return NextResponse.json(\n        { message: 'Invalid email or password' },\n        { status: 401 }\n      );\n    }\n\n    // Clear failed attempts on success\n    clearAttempts(rateLimitKey);\n\n    // Generate session token\n    const token = generateToken();\n    const expiresAt = new Date(Date.now() + SESSION_DURATION).toISOString();\n\n    // Log successful login (for security auditing)\n    console.log(`[AUTH] Successful login: ${email} from ${clientIP} at ${new Date().toISOString()}`);\n\n    return NextResponse.json(\n      {\n        token,\n        expiresAt,\n        message: 'Login successful',\n      },\n      {\n        status: 200,\n        headers: {\n          // Secure cookie headers (if using cookies instead of localStorage)\n          'Cache-Control': 'no-store, no-cache, must-revalidate, max-age=0',\n          'Pragma': 'no-cache',\n        },\n      }\n    );\n  } catch (error) {\n    console.error('[AUTH] Login error:', error);\n    return NextResponse.json(\n      { message: 'An error occurred during authentication' },\n      { status: 500 }\n    );\n  }\n}\n\n// Security headers\nexport const metadata = {\n  headers: {\n    'X-Content-Type-Options': 'nosniff',\n    'X-Frame-Options': 'DENY',\n    'X-XSS-Protection': '1; mode=block',\n  },\n};\n"],"names":[],"mappings":"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"}}]
}