{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/lib/evidenceSheets.ts"],"sourcesContent":["/**\n * Evidence/Report data management\n * All data comes from Google Sheets \"evidence\" tab\n */\n\nexport interface Evidence {\n  id: string;\n  lat: number;\n  lng: number;\n  category: string;\n  severity: 'Low' | 'Medium' | 'High' | 'Critical';\n  note: string;\n  reporter: string;\n  date: string;\n  zone: string;\n  upvotes: number;\n  verified: boolean;\n  status: 'Open' | 'In Progress' | 'Resolved' | 'Escalated';\n  images?: string[];\n  assignedTo?: string;\n  assignedDate?: string;\n}\n\n/**\n * Fetch evidence from Google Sheets\n * Sheet tab name: \"evidence\"\n */\nexport async function fetchEvidenceFromSheets(): Promise<Evidence[]> {\n  const SHEET_ID = process.env.NEXT_PUBLIC_GOOGLE_SHEETS_ID;\n  \n  if (!SHEET_ID) {\n    console.warn('Google Sheets ID not configured');\n    return [];\n  }\n\n  try {\n    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/query?tq=SELECT%20*%20FROM%20'evidence'&tqx=out:json`;\n    const response = await fetch(url);\n    const text = await response.text();\n    \n    console.log('Google Sheets response length:', text.length, 'First 100 chars:', text.substring(0, 100));\n    \n    // Google Sheets response format: )]}' followed by JSON\n    let jsonString = text.trim();\n    \n    // Remove the Google Sheets security prefix if present\n    if (jsonString.startsWith(')]}\\'')) {\n      jsonString = jsonString.substring(4);\n    }\n    \n    // Try to parse the JSON\n    let json;\n    try {\n      json = JSON.parse(jsonString);\n    } catch (parseError) {\n      // If direct parse fails, try to extract JSON object from the string\n      const jsonMatch = jsonString.match(/\\{[\\s\\S]*\\}/);\n      if (!jsonMatch) {\n        console.warn('Could not extract JSON from Google Sheets response:', text.substring(0, 200));\n        return [];\n      }\n      try {\n        json = JSON.parse(jsonMatch[0]);\n      } catch (e) {\n        console.warn('Extracted JSON is still invalid:', jsonMatch[0].substring(0, 100));\n        return [];\n      }\n    }\n    \n    // If table is empty or no rows, return empty array\n    if (!json.table || !json.table.rows || json.table.rows.length === 0) {\n      console.log('Google Sheets table is empty');\n      return [];\n    }\n    \n    const evidence = json.table.rows.map((row: any, idx: number) => {\n      const cols = row.c || [];\n      return {\n        id: cols[0]?.v || `E${idx + 1}`,\n        lat: parseFloat(cols[1]?.v) || 0,\n        lng: parseFloat(cols[2]?.v) || 0,\n        category: cols[3]?.v || '',\n        severity: cols[4]?.v || 'Low',\n        note: cols[5]?.v || '',\n        reporter: cols[6]?.v || '',\n        date: cols[7]?.v || new Date().toISOString().split('T')[0],\n        zone: cols[8]?.v || '',\n        upvotes: parseInt(cols[9]?.v) || 0,\n        verified: cols[10]?.v?.toString().toLowerCase() === 'yes' || cols[10]?.v?.toString().toLowerCase() === 'true',\n        status: cols[11]?.v || 'Open',\n        images: (cols[12]?.v || '').split('|').filter((s: string) => s.trim()),\n        assignedTo: cols[13]?.v || '',\n        assignedDate: cols[14]?.v || '',\n      };\n    });\n\n    return evidence;\n  } catch (error) {\n    console.error('Error fetching evidence from Google Sheets:', error);\n    return [];\n  }\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AAwBM,eAAe;IACpB,MAAM;IAEN;;IAKA,IAAI;QACF,MAAM,MAAM,CAAC,uCAAuC,EAAE,SAAS,0DAA0D,CAAC;QAC1H,MAAM,WAAW,MAAM,MAAM;QAC7B,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,QAAQ,GAAG,CAAC,kCAAkC,KAAK,MAAM,EAAE,oBAAoB,KAAK,SAAS,CAAC,GAAG;QAEjG,uDAAuD;QACvD,IAAI,aAAa,KAAK,IAAI;QAE1B,sDAAsD;QACtD,IAAI,WAAW,UAAU,CAAC,UAAU;YAClC,aAAa,WAAW,SAAS,CAAC;QACpC;QAEA,wBAAwB;QACxB,IAAI;QACJ,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAO,YAAY;YACnB,oEAAoE;YACpE,MAAM,YAAY,WAAW,KAAK,CAAC;YACnC,IAAI,CAAC,WAAW;gBACd,QAAQ,IAAI,CAAC,uDAAuD,KAAK,SAAS,CAAC,GAAG;gBACtF,OAAO,EAAE;YACX;YACA,IAAI;gBACF,OAAO,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;YAChC,EAAE,OAAO,GAAG;gBACV,QAAQ,IAAI,CAAC,oCAAoC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG;gBAC3E,OAAO,EAAE;YACX;QACF;QAEA,mDAAmD;QACnD,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,KAAK,CAAC,IAAI,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC,MAAM,KAAK,GAAG;YACnE,QAAQ,GAAG,CAAC;YACZ,OAAO,EAAE;QACX;QAEA,MAAM,WAAW,KAAK,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,KAAU;YAC9C,MAAM,OAAO,IAAI,CAAC,IAAI,EAAE;YACxB,OAAO;gBACL,IAAI,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC,EAAE,MAAM,GAAG;gBAC/B,KAAK,WAAW,IAAI,CAAC,EAAE,EAAE,MAAM;gBAC/B,KAAK,WAAW,IAAI,CAAC,EAAE,EAAE,MAAM;gBAC/B,UAAU,IAAI,CAAC,EAAE,EAAE,KAAK;gBACxB,UAAU,IAAI,CAAC,EAAE,EAAE,KAAK;gBACxB,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK;gBACpB,UAAU,IAAI,CAAC,EAAE,EAAE,KAAK;gBACxB,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gBAC1D,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK;gBACpB,SAAS,SAAS,IAAI,CAAC,EAAE,EAAE,MAAM;gBACjC,UAAU,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,kBAAkB,SAAS,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,kBAAkB;gBACvG,QAAQ,IAAI,CAAC,GAAG,EAAE,KAAK;gBACvB,QAAQ,CAAC,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,KAAK,CAAC,KAAK,MAAM,CAAC,CAAC,IAAc,EAAE,IAAI;gBACnE,YAAY,IAAI,CAAC,GAAG,EAAE,KAAK;gBAC3B,cAAc,IAAI,CAAC,GAAG,EAAE,KAAK;YAC/B;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 121, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/app/api/data/reports/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { fetchEvidenceFromSheets } from '@/lib/evidenceSheets';\n\nexport async function GET() {\n  try {\n    const evidence = await fetchEvidenceFromSheets();\n    return NextResponse.json(evidence);\n  } catch (error) {\n    console.error('Error fetching evidence from sheets:', error);\n    return NextResponse.json([], { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,uKAAuB;QAC9C,OAAO,oSAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,oSAAY,CAAC,IAAI,CAAC,EAAE,EAAE;YAAE,QAAQ;QAAI;IAC7C;AACF"}}]
}