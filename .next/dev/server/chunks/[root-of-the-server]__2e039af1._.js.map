{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/lib/googleSheetsAuth.ts"],"sourcesContent":["'use server';\n\nimport { google } from 'googleapis';\n\n/**\n * Authenticated Google Sheets API client using service account credentials\n * This allows reading from private sheets that the service account has access to\n * \n * IMPORTANT: This file MUST only be used from server-side contexts (Server Components, API routes)\n * Do NOT import this in Client Components\n */\n\ninterface ServiceAccountCredentials {\n  type: 'service_account';\n  project_id: string;\n  private_key_id: string;\n  private_key: string;\n  client_email: string;\n  client_id: string;\n  auth_uri: string;\n  token_uri: string;\n  auth_provider_x509_cert_url: string;\n  client_x509_cert_url: string;\n  universe_domain: string;\n}\n\n/**\n * Get authenticated Google Sheets client\n */\nfunction getAuthenticatedSheets() {\n  const privateKey = process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, '\\n');\n  const clientEmail = process.env.GOOGLE_SHEETS_CLIENT_EMAIL;\n\n  if (!privateKey || !clientEmail) {\n    console.warn('Google Sheets authentication credentials not configured');\n    return null;\n  }\n\n  try {\n    const auth = new google.auth.GoogleAuth({\n      credentials: {\n        type: 'service_account',\n        private_key: privateKey,\n        client_email: clientEmail,\n      } as any,\n      scopes: [\n        'https://www.googleapis.com/auth/spreadsheets',\n        'https://www.googleapis.com/auth/spreadsheets.readonly',\n      ],\n    });\n\n    return google.sheets({ version: 'v4', auth });\n  } catch (error) {\n    console.error('Failed to authenticate with Google Sheets:', error);\n    return null;\n  }\n}\n\n/**\n * Fetch data from a specific sheet range\n */\nexport async function getSheetData(spreadsheetId: string, range: string) {\n  const sheets = getAuthenticatedSheets();\n  if (!sheets) {\n    throw new Error('Google Sheets client not initialized');\n  }\n\n  try {\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId,\n      range,\n    });\n\n    return response.data.values || [];\n  } catch (error) {\n    console.error(`Failed to fetch sheet data from ${range}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Convert sheet rows to objects using headers\n */\nexport async function rowsToObjects(rows: any[][]): Promise<Record<string, any>[]> {\n  if (rows.length < 2) return [];\n\n  const [headers, ...dataRows] = rows;\n  return dataRows.map(row => {\n    const obj: Record<string, any> = {};\n    headers.forEach((header, index) => {\n      obj[header] = row[index] || '';\n    });\n    return obj;\n  });\n}\n\n/**\n * Append a row to a Google Sheet\n */\nexport async function appendSheetRow(spreadsheetId: string, range: string, values: any[][]) {\n  const sheets = getAuthenticatedSheets();\n  if (!sheets) {\n    throw new Error('Google Sheets client not initialized');\n  }\n\n  try {\n    const response = await sheets.spreadsheets.values.append({\n      spreadsheetId,\n      range,\n      valueInputOption: 'RAW',\n      requestBody: {\n        values,\n      },\n    });\n\n    return response.data;\n  } catch (error) {\n    console.error(`Failed to append to sheet ${range}:`, error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;;;;AAwBA;;CAEC,GACD,SAAS;IACP,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,EAAE,QAAQ,QAAQ;IAC1E,MAAM,cAAc,QAAQ,GAAG,CAAC,0BAA0B;IAE1D,IAAI,CAAC,cAAc,CAAC,aAAa;QAC/B,QAAQ,IAAI,CAAC;QACb,OAAO;IACT;IAEA,IAAI;QACF,MAAM,OAAO,IAAI,6OAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,MAAM;gBACN,aAAa;gBACb,cAAc;YAChB;YACA,QAAQ;gBACN;gBACA;aACD;QACH;QAEA,OAAO,6OAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM;QAAK;IAC7C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8CAA8C;QAC5D,OAAO;IACT;AACF;AAKO,eAAe,aAAa,aAAqB,EAAE,KAAa;IACrE,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACpD;YACA;QACF;QAEA,OAAO,SAAS,IAAI,CAAC,MAAM,IAAI,EAAE;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,MAAM,CAAC,CAAC,EAAE;QAC3D,MAAM;IACR;AACF;AAKO,eAAe,cAAc,IAAa;IAC/C,IAAI,KAAK,MAAM,GAAG,GAAG,OAAO,EAAE;IAE9B,MAAM,CAAC,SAAS,GAAG,SAAS,GAAG;IAC/B,OAAO,SAAS,GAAG,CAAC,CAAA;QAClB,MAAM,MAA2B,CAAC;QAClC,QAAQ,OAAO,CAAC,CAAC,QAAQ;YACvB,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC,MAAM,IAAI;QAC9B;QACA,OAAO;IACT;AACF;AAKO,eAAe,eAAe,aAAqB,EAAE,KAAa,EAAE,MAAe;IACxF,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACvD;YACA;YACA,kBAAkB;YAClB,aAAa;gBACX;YACF;QACF;QAEA,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,0BAA0B,EAAE,MAAM,CAAC,CAAC,EAAE;QACrD,MAAM;IACR;AACF;;;IA3DsB;IAsBA;IAgBA;;AAtCA,qYAAA;AAsBA,qYAAA;AAgBA,qYAAA"}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/lib/imageStorage.ts"],"sourcesContent":["'use server';\n\n/**\n * Image Storage Solution: ImgBB API (Free, 32MB limit)\n * \n * Setup:\n * 1. Get API key: b6632d88e03b63947083f55f13930ff6\n * 2. Add to .env.local: NEXT_PUBLIC_IMGBB_API_KEY=b6632d88e03b63947083f55f13930ff6\n * \n * Images upload automatically when users submit evidence\n */\n\n/**\n * Upload image to ImgBB\n * Returns the image URL or base64 if upload fails\n */\nasync function uploadToImgBB(base64Image: string): Promise<string> {\n  try {\n    const apiKey = process.env.NEXT_PUBLIC_IMGBB_API_KEY;\n\n    // If no ImgBB config, return base64 (fallback)\n    if (!apiKey) {\n      console.log('ImgBB not configured, storing image as base64');\n      return base64Image;\n    }\n\n    // Remove data URL prefix\n    const base64Data = base64Image.replace(/^data:image\\/\\w+;base64,/, '');\n\n    // Create FormData\n    const formData = new FormData();\n    formData.append('key', apiKey);\n    formData.append('image', base64Data);\n    formData.append('name', `evidence_${Date.now()}`);\n    \n    // Upload to ImgBB\n    const uploadResponse = await fetch('https://api.imgbb.com/1/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    if (!uploadResponse.ok) {\n      console.warn('ImgBB upload failed:', uploadResponse.status);\n      return base64Image;\n    }\n\n    const data = await uploadResponse.json();\n    \n    if (data.success && data.data?.url) {\n      console.log('✓ Image uploaded to ImgBB:', data.data.url);\n      return data.data.url;\n    }\n\n    if (data.error) {\n      console.warn('ImgBB error:', data.error.message);\n    }\n\n    return base64Image;\n  } catch (error) {\n    console.warn('Error uploading to ImgBB, falling back to base64:', error);\n    return base64Image;\n  }\n}\n\n/**\n * Process image for submission\n * Tries ImgBB first, falls back to base64\n */\nexport async function processImageForSubmission(base64Image: string | null): Promise<string[]> {\n  if (!base64Image) {\n    return [];\n  }\n\n  try {\n    const imageUrl = await uploadToImgBB(base64Image);\n    return [imageUrl];\n  } catch (error) {\n    console.error('Error processing image:', error);\n    return [base64Image];\n  }\n}\n\n\n\n"],"names":[],"mappings":";;;;;;;AAEA;;;;;;;;CAQC,GAED;;;CAGC,GACD,eAAe,cAAc,WAAmB;IAC9C,IAAI;QACF,MAAM;QAEN,+CAA+C;QAC/C;;QAKA,yBAAyB;QACzB,MAAM,aAAa,YAAY,OAAO,CAAC,4BAA4B;QAEnE,kBAAkB;QAClB,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,OAAO;QACvB,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,QAAQ,CAAC,SAAS,EAAE,KAAK,GAAG,IAAI;QAEhD,kBAAkB;QAClB,MAAM,iBAAiB,MAAM,MAAM,kCAAkC;YACnE,QAAQ;YACR,MAAM;QACR;QAEA,IAAI,CAAC,eAAe,EAAE,EAAE;YACtB,QAAQ,IAAI,CAAC,wBAAwB,eAAe,MAAM;YAC1D,OAAO;QACT;QAEA,MAAM,OAAO,MAAM,eAAe,IAAI;QAEtC,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,EAAE,KAAK;YAClC,QAAQ,GAAG,CAAC,8BAA8B,KAAK,IAAI,CAAC,GAAG;YACvD,OAAO,KAAK,IAAI,CAAC,GAAG;QACtB;QAEA,IAAI,KAAK,KAAK,EAAE;YACd,QAAQ,IAAI,CAAC,gBAAgB,KAAK,KAAK,CAAC,OAAO;QACjD;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,qDAAqD;QAClE,OAAO;IACT;AACF;AAMO,eAAe,0BAA0B,WAA0B;IACxE,IAAI,CAAC,aAAa;QAChB,OAAO,EAAE;IACX;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,cAAc;QACrC,OAAO;YAAC;SAAS;IACnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;YAAC;SAAY;IACtB;AACF;;;IAZsB;;AAAA,qYAAA"}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/app/api/evidence/submit/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { appendSheetRow } from '@/lib/googleSheetsAuth';\nimport { processImageForSubmission } from '@/lib/imageStorage';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n\n    console.log('[Evidence Submit] Received request:', {\n      lat: body.lat,\n      lng: body.lng,\n      category: body.category,\n      severity: body.severity,\n      hasImages: !!body.images?.length,\n      imageCount: body.images?.length || 0,\n      reporter: body.reporter,\n    });\n\n    // Validate required fields\n    if (!body.lat || !body.lng || !body.category) {\n      console.warn('[Evidence Submit] Missing required fields:', {\n        lat: !!body.lat,\n        lng: !!body.lng,\n        category: !!body.category,\n      });\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n\n    const SHEET_ID = process.env.NEXT_PUBLIC_GOOGLE_SHEETS_ID;\n    if (!SHEET_ID) {\n      return NextResponse.json(\n        { error: 'Google Sheets ID not configured' },\n        { status: 500 }\n      );\n    }\n\n    // Process images (convert base64 to URLs if needed)\n    const processedImages = await processImageForSubmission(body.images?.[0] || null);\n\n    // Prepare row data for Google Sheets\n    const evidenceId = `E${Date.now()}`;\n    const row = [\n      [\n        evidenceId,                           // id\n        body.lat.toString(),                   // lat\n        body.lng.toString(),                   // lng\n        body.category,                         // category\n        body.severity || 'Low',                // severity\n        body.note || '',                       // note\n        body.reporter || 'Anonymous',          // reporter\n        body.date || new Date().toISOString().split('T')[0],  // date\n        body.zone || 'User Submitted',         // zone\n        '0',                                   // upvotes\n        'no',                                  // verified\n        body.status || 'Open',                 // status\n        processedImages?.join('|') || '',      // images (URL or base64)\n        body.assignedTo || '',                 // assignedTo\n        body.assignedDate || '',               // assignedDate\n      ]\n    ];\n\n    // Append to evidence sheet\n    await appendSheetRow(SHEET_ID, 'evidence!A:O', row);\n\n    console.log('✓ Evidence saved to Google Sheets:', { \n      id: evidenceId,\n      reporter: body.reporter || 'Anonymous',\n      category: body.category, \n      severity: body.severity,\n      hasImage: processedImages.length > 0,\n      lat: body.lat,\n      lng: body.lng,\n    });\n\n    return NextResponse.json(\n      { \n        success: true, \n        message: 'Report submitted successfully',\n        id: evidenceId\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error('[Evidence Submit] Error submitting evidence:', error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Failed to submit report' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,QAAQ,GAAG,CAAC,uCAAuC;YACjD,KAAK,KAAK,GAAG;YACb,KAAK,KAAK,GAAG;YACb,UAAU,KAAK,QAAQ;YACvB,UAAU,KAAK,QAAQ;YACvB,WAAW,CAAC,CAAC,KAAK,MAAM,EAAE;YAC1B,YAAY,KAAK,MAAM,EAAE,UAAU;YACnC,UAAU,KAAK,QAAQ;QACzB;QAEA,2BAA2B;QAC3B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,QAAQ,EAAE;YAC5C,QAAQ,IAAI,CAAC,8CAA8C;gBACzD,KAAK,CAAC,CAAC,KAAK,GAAG;gBACf,KAAK,CAAC,CAAC,KAAK,GAAG;gBACf,UAAU,CAAC,CAAC,KAAK,QAAQ;YAC3B;YACA,OAAO,oSAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM;QACN;;QAOA,oDAAoD;QACpD,MAAM,kBAAkB,MAAM,IAAA,uKAAyB,EAAC,KAAK,MAAM,EAAE,CAAC,EAAE,IAAI;QAE5E,qCAAqC;QACrC,MAAM,aAAa,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI;QACnC,MAAM,MAAM;YACV;gBACE;gBACA,KAAK,GAAG,CAAC,QAAQ;gBACjB,KAAK,GAAG,CAAC,QAAQ;gBACjB,KAAK,QAAQ;gBACb,KAAK,QAAQ,IAAI;gBACjB,KAAK,IAAI,IAAI;gBACb,KAAK,QAAQ,IAAI;gBACjB,KAAK,IAAI,IAAI,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gBACnD,KAAK,IAAI,IAAI;gBACb;gBACA;gBACA,KAAK,MAAM,IAAI;gBACf,iBAAiB,KAAK,QAAQ;gBAC9B,KAAK,UAAU,IAAI;gBACnB,KAAK,YAAY,IAAI;aACtB;SACF;QAED,2BAA2B;QAC3B,MAAM,IAAA,gKAAc,EAAC,UAAU,gBAAgB;QAE/C,QAAQ,GAAG,CAAC,sCAAsC;YAChD,IAAI;YACJ,UAAU,KAAK,QAAQ,IAAI;YAC3B,UAAU,KAAK,QAAQ;YACvB,UAAU,KAAK,QAAQ;YACvB,UAAU,gBAAgB,MAAM,GAAG;YACnC,KAAK,KAAK,GAAG;YACb,KAAK,KAAK,GAAG;QACf;QAEA,OAAO,oSAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;YACT,IAAI;QACN,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAC9D,OAAO,oSAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAA0B,GAC5E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}