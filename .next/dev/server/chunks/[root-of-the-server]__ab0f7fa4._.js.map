{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/lib/googleSheetsAuth.ts"],"sourcesContent":["'use server';\n\nimport { google } from 'googleapis';\n\n/**\n * Authenticated Google Sheets API client using service account credentials\n * This allows reading from private sheets that the service account has access to\n * \n * IMPORTANT: This file MUST only be used from server-side contexts (Server Components, API routes)\n * Do NOT import this in Client Components\n */\n\ninterface ServiceAccountCredentials {\n  type: 'service_account';\n  project_id: string;\n  private_key_id: string;\n  private_key: string;\n  client_email: string;\n  client_id: string;\n  auth_uri: string;\n  token_uri: string;\n  auth_provider_x509_cert_url: string;\n  client_x509_cert_url: string;\n  universe_domain: string;\n}\n\n/**\n * Get authenticated Google Sheets client\n */\nfunction getAuthenticatedSheets() {\n  const privateKey = process.env.GOOGLE_SHEETS_PRIVATE_KEY?.replace(/\\\\n/g, '\\n');\n  const clientEmail = process.env.GOOGLE_SHEETS_CLIENT_EMAIL;\n\n  if (!privateKey || !clientEmail) {\n    console.warn('Google Sheets authentication credentials not configured');\n    return null;\n  }\n\n  try {\n    const auth = new google.auth.GoogleAuth({\n      credentials: {\n        type: 'service_account',\n        private_key: privateKey,\n        client_email: clientEmail,\n      } as any,\n      scopes: [\n        'https://www.googleapis.com/auth/spreadsheets',\n        'https://www.googleapis.com/auth/spreadsheets.readonly',\n      ],\n    });\n\n    return google.sheets({ version: 'v4', auth });\n  } catch (error) {\n    console.error('Failed to authenticate with Google Sheets:', error);\n    return null;\n  }\n}\n\n/**\n * Fetch data from a specific sheet range\n */\nexport async function getSheetData(spreadsheetId: string, range: string) {\n  const sheets = getAuthenticatedSheets();\n  if (!sheets) {\n    throw new Error('Google Sheets client not initialized');\n  }\n\n  try {\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId,\n      range,\n    });\n\n    return response.data.values || [];\n  } catch (error) {\n    console.error(`Failed to fetch sheet data from ${range}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Convert sheet rows to objects using headers\n */\nexport async function rowsToObjects(rows: any[][]): Promise<Record<string, any>[]> {\n  if (rows.length < 2) return [];\n\n  const [headers, ...dataRows] = rows;\n  return dataRows.map(row => {\n    const obj: Record<string, any> = {};\n    headers.forEach((header, index) => {\n      obj[header] = row[index] || '';\n    });\n    return obj;\n  });\n}\n\n/**\n * Append a row to a Google Sheet\n */\nexport async function appendSheetRow(spreadsheetId: string, range: string, values: any[][]) {\n  const sheets = getAuthenticatedSheets();\n  if (!sheets) {\n    throw new Error('Google Sheets client not initialized');\n  }\n\n  try {\n    const response = await sheets.spreadsheets.values.append({\n      spreadsheetId,\n      range,\n      valueInputOption: 'RAW',\n      requestBody: {\n        values,\n      },\n    });\n\n    return response.data;\n  } catch (error) {\n    console.error(`Failed to append to sheet ${range}:`, error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;;;;AAwBA;;CAEC,GACD,SAAS;IACP,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB,EAAE,QAAQ,QAAQ;IAC1E,MAAM,cAAc,QAAQ,GAAG,CAAC,0BAA0B;IAE1D,IAAI,CAAC,cAAc,CAAC,aAAa;QAC/B,QAAQ,IAAI,CAAC;QACb,OAAO;IACT;IAEA,IAAI;QACF,MAAM,OAAO,IAAI,6OAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,aAAa;gBACX,MAAM;gBACN,aAAa;gBACb,cAAc;YAChB;YACA,QAAQ;gBACN;gBACA;aACD;QACH;QAEA,OAAO,6OAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM;QAAK;IAC7C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8CAA8C;QAC5D,OAAO;IACT;AACF;AAKO,eAAe,aAAa,aAAqB,EAAE,KAAa;IACrE,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACpD;YACA;QACF;QAEA,OAAO,SAAS,IAAI,CAAC,MAAM,IAAI,EAAE;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,MAAM,CAAC,CAAC,EAAE;QAC3D,MAAM;IACR;AACF;AAKO,eAAe,cAAc,IAAa;IAC/C,IAAI,KAAK,MAAM,GAAG,GAAG,OAAO,EAAE;IAE9B,MAAM,CAAC,SAAS,GAAG,SAAS,GAAG;IAC/B,OAAO,SAAS,GAAG,CAAC,CAAA;QAClB,MAAM,MAA2B,CAAC;QAClC,QAAQ,OAAO,CAAC,CAAC,QAAQ;YACvB,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC,MAAM,IAAI;QAC9B;QACA,OAAO;IACT;AACF;AAKO,eAAe,eAAe,aAAqB,EAAE,KAAa,EAAE,MAAe;IACxF,MAAM,SAAS;IACf,IAAI,CAAC,QAAQ;QACX,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACvD;YACA;YACA,kBAAkB;YAClB,aAAa;gBACX;YACF;QACF;QAEA,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,0BAA0B,EAAE,MAAM,CAAC,CAAC,EAAE;QACrD,MAAM;IACR;AACF;;;IA3DsB;IAsBA;IAgBA;;AAtCA,qYAAA;AAsBA,qYAAA;AAgBA,qYAAA"}},
    {"offset": {"line": 239, "column": 0}, "map": {"version":3,"sources":["file:///Users/kaushikieee/Downloads/code/app/api/evidence/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { getSheetData } from '@/lib/googleSheetsAuth';\n\nexport interface Evidence {\n  id: string;\n  lat: number;\n  lng: number;\n  category: string;\n  severity: 'Low' | 'Medium' | 'High' | 'Critical';\n  note: string;\n  reporter: string;\n  date: string;\n  zone: string;\n  upvotes: number;\n  verified: boolean;\n  status: 'Open' | 'In Progress' | 'Resolved' | 'Escalated';\n  images?: string[];\n  assignedTo?: string;\n  assignedDate?: string;\n}\n\nexport async function GET() {\n  const SHEET_ID = process.env.NEXT_PUBLIC_GOOGLE_SHEETS_ID;\n\n  if (!SHEET_ID) {\n    return NextResponse.json(\n      { error: 'Google Sheets ID not configured' },\n      { status: 500 }\n    );\n  }\n\n  try {\n    const rows = await getSheetData(SHEET_ID, 'evidence!A2:O1000');\n\n    if (!rows || rows.length === 0) {\n      console.log('Google Sheets evidence table is empty');\n      return NextResponse.json([]);\n    }\n\n    const evidence: Evidence[] = rows.map((row: any, idx: number) => {\n      return {\n        id: row[0] || `E${idx + 1}`,\n        lat: parseFloat(row[1]) || 0,\n        lng: parseFloat(row[2]) || 0,\n        category: row[3] || '',\n        severity: row[4] || 'Low',\n        note: row[5] || '',\n        reporter: row[6] || '',\n        date: row[7] || new Date().toISOString().split('T')[0],\n        zone: row[8] || '',\n        upvotes: parseInt(row[9]) || 0,\n        verified: row[10]?.toString().toLowerCase() === 'yes' || row[10]?.toString().toLowerCase() === 'true',\n        status: row[11] || 'Open',\n        images: (row[12] || '').split('|').filter((s: string) => s.trim()),\n        assignedTo: row[13] || '',\n        assignedDate: row[14] || '',\n      };\n    });\n\n    console.log(`âœ“ Fetched ${evidence.length} evidence items from Google Sheets`);\n    return NextResponse.json(evidence);\n  } catch (error) {\n    console.error('Error fetching evidence from Google Sheets:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch evidence data' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoBO,eAAe;IACpB,MAAM;IAEN;;IAOA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,8JAAY,EAAC,UAAU;QAE1C,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC9B,QAAQ,GAAG,CAAC;YACZ,OAAO,oSAAY,CAAC,IAAI,CAAC,EAAE;QAC7B;QAEA,MAAM,WAAuB,KAAK,GAAG,CAAC,CAAC,KAAU;YAC/C,OAAO;gBACL,IAAI,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,MAAM,GAAG;gBAC3B,KAAK,WAAW,GAAG,CAAC,EAAE,KAAK;gBAC3B,KAAK,WAAW,GAAG,CAAC,EAAE,KAAK;gBAC3B,UAAU,GAAG,CAAC,EAAE,IAAI;gBACpB,UAAU,GAAG,CAAC,EAAE,IAAI;gBACpB,MAAM,GAAG,CAAC,EAAE,IAAI;gBAChB,UAAU,GAAG,CAAC,EAAE,IAAI;gBACpB,MAAM,GAAG,CAAC,EAAE,IAAI,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gBACtD,MAAM,GAAG,CAAC,EAAE,IAAI;gBAChB,SAAS,SAAS,GAAG,CAAC,EAAE,KAAK;gBAC7B,UAAU,GAAG,CAAC,GAAG,EAAE,WAAW,kBAAkB,SAAS,GAAG,CAAC,GAAG,EAAE,WAAW,kBAAkB;gBAC/F,QAAQ,GAAG,CAAC,GAAG,IAAI;gBACnB,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,EAAE,EAAE,KAAK,CAAC,KAAK,MAAM,CAAC,CAAC,IAAc,EAAE,IAAI;gBAC/D,YAAY,GAAG,CAAC,GAAG,IAAI;gBACvB,cAAc,GAAG,CAAC,GAAG,IAAI;YAC3B;QACF;QAEA,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,SAAS,MAAM,CAAC,kCAAkC,CAAC;QAC5E,OAAO,oSAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,OAAO,oSAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAgC,GACzC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}