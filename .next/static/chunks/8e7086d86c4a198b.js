(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85945,e=>{"use strict";let t=(0,e.i(77735).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],85945)},60289,e=>{"use strict";let t=(0,e.i(77735).default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);e.s(["Share2",()=>t],60289)},52964,e=>{"use strict";let t=(0,e.i(77735).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],52964)},87654,e=>{"use strict";function t(e,t){if(!e.trim())return t;let l=e.toLowerCase();return t.filter(e=>e.name.toLowerCase().includes(l)).sort((e,t)=>e.name.toLowerCase().indexOf(l)-t.name.toLowerCase().indexOf(l)).slice(0,5)}e.s(["fuzzySearch",()=>t])},29568,e=>{"use strict";let t=(0,e.i(77735).default)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);e.s(["Camera",()=>t],29568)},68498,e=>{"use strict";let t=(0,e.i(77735).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],68498)},10224,e=>{"use strict";let t=(0,e.i(77735).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],10224)},10897,e=>{"use strict";let t=(0,e.i(77735).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>t],10897)},50608,e=>{"use strict";var t=e.i(122),l=e.i(45471),s=e.i(17591),r=e.i(85945),a=e.i(3407),o=e.i(52964),n=e.i(10897),i=e.i(37213),c=e.i(10224),d=e.i(60289),m=e.i(29568),x=e.i(68498),u=e.i(69257),h=e.i(87654);let g=[{name:"School Gate",lat:12.9716,lng:77.5946,zone:"Zone P1"},{name:"Park North",lat:12.974,lng:77.5955,zone:"Zone W2"},{name:"Sports Field",lat:12.9705,lng:77.5935,zone:"Zone P2"},{name:"Drainage Area",lat:12.9719,lng:77.595,zone:"Zone P1"},{name:"Construction Site",lat:12.9715,lng:77.5965,zone:"Zone C3"},{name:"Residential Corner",lat:12.971,lng:77.592,zone:"Zone W3"},{name:"Industrial Zone",lat:12.9745,lng:77.5945,zone:"Zone S1"},{name:"Local Market",lat:12.9695,lng:77.5955,zone:"Zone P3"},{name:"Park South",lat:12.9735,lng:77.593,zone:"Zone O1"},{name:"Walking Trail",lat:12.9725,lng:77.5938,zone:"Zone C2"}],p=["Soil contamination","Stagnant water","Plastic / microplastics","Damaged turf / turf runoff","Waste dumping","Other"],y=[{label:"Low",color:"#c6f6d5",textColor:"#15803d"},{label:"Medium",color:"#fcd34d",textColor:"#78350f"},{label:"High",color:"#fca5a5",textColor:"#7f1d1d"}];function b(){let[e,b]=(0,l.useState)(null),[f,j]=(0,l.useState)(null),[v,N]=(0,l.useState)(!0),[w,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)(""),[P,z]=(0,l.useState)([]),[R,L]=(0,l.useState)(""),[T,A]=(0,l.useState)(""),[Z,O]=(0,l.useState)(""),[q,D]=(0,l.useState)(""),[$,E]=(0,l.useState)(null),[F,M]=(0,l.useState)(null),U=(0,l.useRef)(null),W=(0,l.useRef)(null),[I,G]=(0,l.useState)(!1),[B,H]=(0,l.useState)(""),[K,Y]=(0,l.useState)(!1),[J,V]=(0,l.useState)("");(0,s.useRouter)(),(0,l.useEffect)(()=>{w?N(!1):"geolocation"in navigator?navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:l}=e.coords;b({lat:t,lng:l,name:"Current Location"}),N(!1)},e=>{console.log("[NewReport] Geolocation error:",e.message),j("Unable to access your location. Please enable location permissions."),N(!1)}):(j("Geolocation is not supported by your browser."),N(!1))},[w]),(0,l.useEffect)(()=>{C.trim()?z((0,h.fuzzySearch)(C,g)):z([])},[C]);let X=e=>{b({lat:e.lat,lng:e.lng,name:e.name}),S(""),z([]),k(!1)},Q=e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onloadend=()=>{let t=e.result;E(t),M(t)},e.readAsDataURL(t)}},_=async t=>{if(t.preventDefault(),!e?.lat||!e?.lng)return void H("Location is required");if(!R)return void H("Please select a pollution category");if(!T)return void H("Please select a severity level");if(!Z.trim())return void H("Please describe the issue");try{G(!0),H(""),console.log("[NewReport] Submitting evidence directly without sessionStorage:",{lat:e.lat,lng:e.lng,category:R,severity:T,description:Z,reporter:q||"Anonymous",hasPhoto:!!$});let t={lat:e.lat,lng:e.lng,category:R,severity:T,note:Z,reporter:q||"Anonymous",date:new Date().toISOString().split("T")[0],zone:"User Submitted",upvotes:0,verified:!1,status:"Open",images:$?[$]:[]},l=await fetch("/api/evidence/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[NewReport] API response:",{status:l.status,ok:l.ok}),!l.ok){let e=await l.json().catch(()=>({error:"Unknown error"}));throw Error(e.error||`Failed to submit report (${l.status})`)}let s=await l.json();console.log("[NewReport] Submission successful:",s),V(s.id||`E${Date.now()}`),Y(!0)}catch(e){console.error("[NewReport] Error submitting report:",e),H(e instanceof Error?e.message:"Failed to submit report. Please try again.")}finally{G(!1)}};return K?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center px-4",style:{backgroundColor:"var(--peep-neutral-1)"},children:[(0,t.jsx)(c.CheckCircle2,{className:"w-16 h-16 mb-4",style:{color:"var(--peep-primary)"}}),(0,t.jsx)("h1",{className:"text-2xl font-bold mb-2 text-center text-balance",children:"Report Submitted!"}),(0,t.jsx)("p",{className:"text-gray-600 text-center mb-2",children:"Your evidence has been added to PEEP."}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 text-center mb-6",children:["ID: ",J]}),(0,t.jsx)(u.default,{href:"/peep/user",className:"w-full max-w-sm py-3 px-4 rounded-2xl font-semibold text-white text-center transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Back to Home"}),(0,t.jsxs)("button",{className:"w-full max-w-sm mt-2 py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-700 text-sm flex items-center justify-center gap-2",children:[(0,t.jsx)(d.Share2,{className:"w-4 h-4"})," Share This Report"]})]}):v&&!w?(0,t.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,t.jsx)(u.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(r.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,t.jsx)("div",{className:"w-10"})]}),(0,t.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto animate-pulse",style:{backgroundColor:"var(--peep-primary)"},children:(0,t.jsx)(a.MapPin,{className:"w-8 h-8 text-white"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Finding your location..."}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"This helps us pinpoint where the issue is."}),(0,t.jsx)("button",{onClick:()=>k(!0),className:"text-sm font-semibold",style:{color:"var(--peep-primary)"},children:"Search location instead"})]})})]}):f&&!w?(0,t.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,t.jsx)(u.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(r.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,t.jsx)("div",{className:"w-10"})]}),(0,t.jsx)("div",{className:"flex-1 px-4 py-8 flex flex-col items-center justify-center",children:(0,t.jsxs)("div",{className:"w-full max-w-sm text-center space-y-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mx-auto bg-red-100",children:(0,t.jsx)(o.AlertCircle,{className:"w-8 h-8 text-red-600"})}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Location Access Required"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:f}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Please enable location in your browser settings and refresh."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"flex-1 py-3 px-4 rounded-lg font-semibold text-white transition-all active:scale-95",style:{backgroundColor:"var(--peep-primary)"},children:"Try Again"}),(0,t.jsx)("button",{onClick:()=>k(!0),className:"flex-1 py-3 px-4 rounded-lg font-semibold border-2",style:{borderColor:"var(--peep-primary)",color:"var(--peep-primary)"},children:"Search Instead"})]})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-white flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white z-10",children:[(0,t.jsx)(u.default,{href:"/peep/user",className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(r.ChevronLeft,{className:"w-5 h-5"})}),(0,t.jsx)("h1",{className:"text-lg font-semibold",children:"New Report"}),(0,t.jsx)("div",{className:"w-10"})]}),(0,t.jsxs)("form",{onSubmit:_,className:"flex-1 overflow-y-auto px-4 py-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Location *"}),e?(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-green-900",children:e.name||`${e.lat.toFixed(4)}, ${e.lng.toFixed(4)}`}),(0,t.jsx)("button",{type:"button",onClick:()=>{b(null),k(!0)},className:"text-xs text-green-700 hover:text-green-900 font-semibold",children:"Change Location"})]}):w?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border-2 border-gray-300 rounded-lg",children:[(0,t.jsx)(n.Search,{className:"w-5 h-5 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Type location name...",value:C,onChange:e=>S(e.target.value),autoFocus:!0,className:"flex-1 outline-none text-sm"}),C&&(0,t.jsx)("button",{type:"button",onClick:()=>{S(""),z([])},className:"p-1 hover:bg-gray-100 rounded",children:(0,t.jsx)(i.X,{className:"w-4 h-4 text-gray-400"})})]}),P.length>0&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto",children:P.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>X(e),className:"w-full text-left px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-0 transition-colors",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:e.zone})]},`${e.lat}-${e.lng}`))})]}),(0,t.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-700",children:"Suggested locations:"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:g.slice(0,6).map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>X(e),className:"p-2 text-left rounded border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.zone})]},`${e.lat}-${e.lng}`))})]})]}):null]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Pollution Type *"}),(0,t.jsxs)("select",{value:R,onChange:e=>L(e.target.value),className:"w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"",children:"Select category..."}),p.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Severity *"}),(0,t.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>A(e.label),className:`w-full p-3 rounded-lg border-2 transition-all text-left font-semibold ${T===e.label?"border-gray-400 shadow-md":"border-gray-200 hover:border-gray-300"}`,style:{backgroundColor:e.color,color:e.textColor},children:e.label},e.label))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Description *"}),(0,t.jsx)("textarea",{value:Z,onChange:e=>O(e.target.value.slice(0,200)),placeholder:"Describe what you see. What's the issue? What's the impact?",className:"w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",rows:4}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1 text-right",children:[Z.length,"/200 characters"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Photo (optional)"}),F?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("img",{src:F,alt:"Preview",className:"w-full rounded-lg object-cover max-h-48"}),(0,t.jsx)("button",{type:"button",onClick:()=>{E(null),M(null),U.current&&(U.current.value=""),W.current&&(W.current.value="")},className:"w-full py-2 px-4 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 text-sm font-semibold",children:"Remove Photo"})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>W.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all flex items-center justify-center gap-2 text-sm font-semibold text-gray-700",children:[(0,t.jsx)(m.Camera,{className:"w-5 h-5"})," Take Photo"]}),(0,t.jsx)("button",{type:"button",onClick:()=>U.current?.click(),className:"w-full py-3 px-4 rounded-lg border-2 border-gray-300 hover:border-gray-400 transition-all text-sm font-semibold text-gray-700",children:"Choose from Gallery"})]}),(0,t.jsx)("input",{ref:W,type:"file",accept:"image/*",capture:!0,onChange:Q,className:"hidden"}),(0,t.jsx)("input",{ref:U,type:"file",accept:"image/*",onChange:Q,className:"hidden"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Your Name (optional)"}),(0,t.jsx)("input",{type:"text",value:q,onChange:e=>D(e.target.value),placeholder:"Leave blank to be anonymous",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),B&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex gap-3",children:[(0,t.jsx)(x.AlertTriangle,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,t.jsx)("p",{className:"text-sm text-red-700",children:B})]}),(0,t.jsx)("button",{type:"submit",disabled:I||!e||!R||!T||!Z.trim(),className:"w-full py-4 px-4 rounded-2xl font-semibold text-white transition-all active:scale-95 disabled:opacity-50 sticky bottom-0 mt-6",style:{backgroundColor:"var(--peep-primary)"},children:I?"Submitting...":"Submit Report"})]})]})}e.s(["default",()=>b])}]);